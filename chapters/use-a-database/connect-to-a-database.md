## การเชื่อมต่อกับฐานข้อมูล

เราจำเป็นต้องเตรียมการบางอย่างก่อนใช้ Entity Framework Core เพื่อเชื่อมต่อกับฐานข้อมูล แต่เนื่องจากเราใช้คำสั่ง `dotnet new` ร่วมกับเทมเพลต MVC + Individual Auth เพื่อจัดเตรียมโปรเจกต์ เราจึงมีทุกอย่างพร้อมแล้ว:

* **แพคเกจของ Entity Framework Core** ซึ่งรวมอยู่ในโปรเจกต์ ASP.NET Core ทั้งหมดมาตั้งแต่แรก

* **ฐานข้อมูล** (ก็แน่อยู่แล้ว) ไฟล์ `app.db` ที่อยู่ในไดเรกทอรีรากของโปรเจกต์เป็นไฟล์ฐานข้อมูล SQLite ที่ถูกสร้างขึ้นหลังจากเรียกใช้คำสั่ง `dotnet new` โดย SQLite คือกลไกฐานข้อมูลขนาดเล็กที่สามารถทำงานได้โดยไม่จำเป็นต้องติดตั้งเครื่องมือใด ๆ เพิ่มเติมลงในเครื่อง ดังนั้นจึงทำให้ใช้ในการพัฒนาได้อย่างสะดวกและรวดเร็ว

* **คลาสบริบทฐานข้อมูล (database context class)** บริบทฐานข้อมูลคือคลาสในภาษา C# ที่จัดเตรียมจุดเริ่มต้นไว้สำหรับเข้าสู่ฐานข้อมูล และเป็นสิ่งที่ระบุว่าโค้ดของคุณจะสื่อสารกับฐานข้อมูลเพื่ออ่านและเขียนรายการต่าง ๆ อย่างไร โดยคลาสบริบทอย่างง่ายนั้นมีอยู่แล้วในไฟล์ `Data/ApplicationDbContext.cs`

* **สตริงเชื่อมต่อ (connection string)** ไม่ว่าคุณจะเชื่อมต่อไปยังฐานข้อมูลที่เป็นไฟล์ในเครื่องเดียวกัน (เช่น SQLite) หรือฐานข้อมูลบนเครื่องอื่น คุณจะต้องกำหนดสตริงที่มีชื่อหรือที่อยู่ของฐานข้อมูลที่ต้องการเชื่อมต่อ ซึ่งขั้นตอนนี้ได้ถูกจัดเตรียมไว้เรียบร้อยแล้วในไฟล์ `appsettings.json`: โดยสตริงเชื่อมต่อสำหรับฐานข้อมูล SQLite ในที่นี้คือ `DataSource=app.db`.

Entity Framework Core ใช้บริบทฐานข้อมูลร่วมกันกับสตริงเชื่อมต่อเพื่อสร้างการเชื่อมต่อไปยังฐานข้อมูล คุณจำเป็นต้องบอก Entity Framework Core ว่าจะให้ใช้บริบท, สตริงเชื่อมต่อ และผู้ให้บริการฐานข้อมูลรายใด โดยระบุไว้ในเมธอด `ConfigureServices` ของคลาส `Startup` ซึ่งในที่นี้ได้ถูกกำหนดไว้ให้เรียบร้อยแล้วจากการใช้เทมเพลต:

```csharp
services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlite(
        Configuration.GetConnectionString("DefaultConnection")));
```

โค้ดนี้จะเพิ่ม `ApplicationDbContext` เข้าไปในที่เก็บบริการ แล้วบอก Entity Framework Core ให้ใช้ผู้ให้บริการฐานข้อมูล SQLite พร้อมทั้งใช้สตริงเชื่อมต่อจากโครงแบบ (`appsettings.json`)

ดังที่เห็นข้างต้น คำสั่ง `dotnet new` ช่วยสร้างหลายอย่างให้คุณไว้ล่วงหน้าแล้ว! ฐานข้อมูลก็ได้ถูกจัดเตรียมไว้ให้เช่นกัน แต่ยังไม่มีตารางใด ๆ ไว้สำหรับจัดเก็บรายการสิ่งที่ต้องทำ เพื่อให้สามารถจัดเก็บเอนทิตี `TodoItem` ของคุณได้ คุณจำเป็นต้องปรับบริบทและย้ายฐานข้อมูล
